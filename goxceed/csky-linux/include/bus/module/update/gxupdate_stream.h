#ifndef __GXUPDATE_STREAM_H__
#define __GXUPDATE_STREAM_H__

#include "gxcore.h"
#include "gxupdate_def.h"

__BEGIN_DECLS

#define E_OK                                (0)
#define E_INVALID_HANDLE                    (0)
#define GXUPDATE_STREAM_BLOCK_SIZE          (1024*4)
#define GXUPDATE_STREAM_PERCENT_RATION      (10000)
#define GXUPDATE_STREAM_FINISH              (0x1fffffff)
#define GXUPDATE_STREAM_CONTINUE            (0x2fffffff)
/*
 * Goxceed?????ܹ?ʾ??ͼ
 *  -----------------------------
 *  |   Application             |<--Ӧ?ò?????
 *  |---------------------------|
 *  |   Stream Protocol         |<--????Э??
 *  |---------------------------|
 *  |   Transport Protocol      |<--??????
 *  |   -----------------       |
 *  | serial | MPEG2 TS | Tftp  |<--??????????Э??
 *  ----------------------------
 */


/**
 * @brief       ????????ʼ??
 * @param [in]  ProtocolList        ????Э???б?
 * @param [in]  PartitionList       ?????????б?
 * @return      int32_t             ????E_OK??ʼ???ɹ???????ֵʧ??
 * @remarks     ????Ҫ??ProtocolList??ָ??ָ????????ָ?룬ָ????????????һ??????
 *              ??NULL???Ա?ʾ??????????
 *              ????Ҫ??PartitionList??ָ??ָ????????ָ?룬ָ????????????һ??????
 *              ??NULL???Ա?ʾ??????????
 * @see     ::GxUpdate_StreamOpen ::GxUpdate_StreamIoctl ::GxUpdate_StreamClose
 */
int32_t GxUpdate_StreamInit(GxUpdate_ProtocolOps**ProtocolList, GxUpdate_PartitionOps** PartitionList);


/**
 * @brief       ??????????
 * @param [in]  Name                ?????????ַ???
 * @return      handle_t            ????????????????ִ??ʧ?ܷ???E_INVALID_HANDLE??
                                    ????ֵ??ʾִ?гɹ?
 * @remarks
 * @see     ::GxUpdate_StreamInit ::GxUpdate_StreamIoctl ::GxUpdate_StreamClose
 */
handle_t GxUpdate_StreamOpen(const GxUpdate_StreamName Name);

/**
 * @brief       ??????????
 * @param [in]  Handle              ?򿪵???????????
 * @param [in]  Key                 ???ñ?ʶKEY
 * @param [in]  Buf                 ???ñ?ʶKEY??Ӧ?Ĳ???
 * @param [in]  Size                ???ñ?ʶKEY??????С
 * @return      int32_t             ִ?гɹ?????E_OK??????ֵʧ??
 * @remarks     ??KEYֵΪGXUPDATE_STREAM_UPDATE_STOPʱ???????????Ѿ?????
 *               GXUPDATE_STREAM_UPDATE_START??????????GXUPDATE_STREAM_UPDATE_STOP
 *               Ϊ?˷?ֹ???ݱ??ƻ?????ʱSTOP???ý????????á??
 * @see     ::GxUpdate_StreamInit ::GxUpdate_StreamOpen ::GxUpdate_StreamClose
 *          ::GXUPDATE_STREAM_PROTOCOL_SELECT ::GXUPDATE_STREAM_PROTOCOL_CTRL
 *          ::GXUPDATE_STREAM_UPDATE_START ::GXUPDATE_STREAM_UPDATE_STOP
 *          ::GXUPDATE_STREAM_UPDATE_GET_PERCENT ::GXUPDATE_STREAM_UPDATE_GET_STATUS
 */
int32_t GxUpdate_StreamIoctl(handle_t Handle, int32_t Key, void*  Buf, size_t Size);

/**
 * @brief       ?ر??ҿ?????????
 * @param [in]  Handle              ??????????
 * @return      int32_t             ????E_OKִ?гɹ???????ֵʧ??
 * @remarks
 * @see     ::GxUpdate_StreamInit ::GxUpdate_StreamOpen ::GxUpdate_StreamIoctl
 */
int32_t GxUpdate_StreamClose(handle_t Handle);

/**
 * @brief       ????״̬
 * @param [in]  Handle              ??????????
 * @return      int32_t             ????E_OKִ?гɹ???????ֵʧ??
 * @remarks
 * @see     ::GxUpdate_StreamInit ::GxUpdate_StreamOpen ::GxUpdate_StreamIoctl
 */
int32_t GxUpdate_StreamClearStatus(handle_t Handle);

/**
 * @brief      ??ȡ״̬
 * @param [in]
 * @return      int32_t
 * @remarks
 * @see     ::GxUpdate_StreamInit ::GxUpdate_StreamOpen ::GxUpdate_StreamIoctl
 */
int32_t GxUpdate_StreamGetStatus(void);

__END_DECLS

#endif

